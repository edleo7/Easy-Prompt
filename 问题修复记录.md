# 问题修复记录

## 修复时间
2025年10月14日

## 问题描述

### 问题1：前端页面报错
**错误信息**：
```
SyntaxError: The requested module '/src/services/api.js?t=1760316706051' 
does not provide an export named 'request'
```

**原因**：`frontend/src/services/api.js` 文件中的 `request` 函数定义了但没有导出，导致 `knowledgeBase.js` 无法导入使用。

**解决方案**：
```javascript
// 在 api.js 末尾添加导出
export { request }
```

### 问题2：后端端口占用
**错误信息**：
```
Error: listen EADDRINUSE: address already in use :::3002
```

**原因**：3002端口被之前的进程占用。

**解决方案**：
1. 杀掉占用3002端口的进程
2. 统一改为使用3001端口

## 修复内容

### 1. 修复 request 导出问题
**文件**：`frontend/src/services/api.js`
```javascript
// 在文件末尾添加
export { request }
```

### 2. 创建后端环境变量
**文件**：`backend/.env`
```env
PORT=3001
NODE_ENV=development
JWT_SECRET=your-secret-key-change-in-production
DATABASE_URL="file:./prisma/dev.db"
```

### 3. 创建前端环境变量
**文件**：`frontend/.env.development`
```env
VITE_API_BASE_URL=http://localhost:3001/api/v1
```

### 4. 更新前端API配置
**文件**：`frontend/src/services/api.js`
```javascript
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3001/api/v1'
```

**文件**：`frontend/src/services/knowledgeBase.js`
```javascript
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:3001/api/v1'
```

### 5. 重启服务
```bash
# 杀掉占用端口的进程
lsof -ti :3002 | xargs kill -9

# 启动后端（现在使用3001端口）
cd backend && npm start
```

## 修复后状态

### ✅ 后端服务
- 端口：3001
- 状态：正常运行
- 健康检查：http://localhost:3001/health

### ✅ 前端服务
- 端口：5173（Vite默认）
- API地址：http://localhost:3001/api/v1
- 状态：正常运行

### ✅ API导出
- `request` 函数已正确导出
- `knowledgeBase.js` 可以正常导入使用

## 验证步骤

1. **检查后端是否运行**：
   ```bash
   lsof -i :3001 | grep LISTEN
   ```

2. **刷新浏览器**：
   - 访问 http://localhost:3001
   - 应该不再报错
   - 可以正常登录和使用

3. **测试知识库功能**：
   - 登录系统（admin@example.com / admin123）
   - 点击"知识库管理"
   - 应该能看到知识库卡片
   - 可以创建和编辑知识库

## 端口配置总结

| 服务 | 端口 | 用途 |
|------|------|------|
| 后端API | 3001 | Express服务器 |
| 前端开发服务器 | 5173 | Vite开发服务器 |

## 注意事项

1. **环境变量优先级**：
   - 后端：使用 `.env` 文件中的 `PORT`
   - 前端：使用 `.env.development` 中的 `VITE_API_BASE_URL`

2. **端口统一**：
   - 所有配置现在统一使用 3001 端口
   - 避免端口冲突

3. **重启要求**：
   - 修改环境变量后需要重启服务才能生效
   - 修改 `.env` 文件后需要重启后端
   - 修改 `.env.development` 后需要重启前端

## 问题已解决 ✅

现在系统应该可以正常运行了！请刷新浏览器页面测试。

